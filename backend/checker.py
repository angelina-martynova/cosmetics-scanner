import re
import json
import requests
from datetime import datetime, timedelta
import sqlite3
import os
import traceback


class IngredientChecker:
    def __init__(self, use_cache=True, fallback_to_local=True):
        print("üîÑ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IngredientChecker...")
        self.local_ingredients = self.load_local_ingredients()
        self.common_fixes = self.load_common_fixes()
        
        # –í–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö
        self.external_sources = ExternalDataFetcher()
        self.use_cache = use_cache
        self.fallback_to_local = fallback_to_local
        
        # –ö—ç—à –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞
        self.search_cache = {}
        
        # –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –°–ü–ò–°–û–ö –°–¢–û–ü-–°–õ–û–í
        # –¢–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —É–∫—Ä–∞–∏–Ω—Å–∫–∏–µ —Å–ª–æ–≤–∞ —Å —ç—Ç–∏–∫–µ—Ç–æ–∫, –Ω–µ —è–≤–ª—è—é—â–∏–µ—Å—è –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏
        self.stop_words = {
            # –û–±—â–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ –∏ —Ä–∞–∑–¥–µ–ª—ã
            '—Å–∫–ª–∞–¥', '—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏', 'ingredients', 'inci', '—Å–∫–ª–∞–¥:', '—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏:',
            '–ø—Ä–æ–¥—É–∫—Ç', '–ø—Ä–æ–¥—É–∫—Ü—ñ—è', 'product', '–Ω–∞–∑–≤–∞', '–≤–∏—Ä–æ–±–Ω–∏–∫', '–≤–∏–≥–æ—Ç–æ–≤–ª—é–≤–∞—á',
            '—É–ø–∞–∫–æ–≤–∫–∞', '–ø–∞–∫—É–≤–∞–Ω–Ω—è', '–ø–∞–∫–µ—Ç', '–ø–ª—è—à–∫–∞', '—Ç—É–±–∞', '—Ñ–ª–∞–∫–æ–Ω',
            
            # –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–Ω–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã)
            '—Ç–µ—Ä–º—ñ–Ω', '–ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ', '–ø—Ä–∏–¥–∞—Ç–Ω–∏–π', '–∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è', '–¥–∞—Ç–∞', '—Ä—ñ–∫',
            '–º—ñ—Å—è—Ü—å', '–∫—ñ–Ω–µ—Ü—å', '–≤–∂–∏—Ç–∏', '–¥–æ', '–∫—ñ–Ω—Ü—è', '–ø–∞–∫—É–≤–∞–Ω–Ω—è',
            '–º–∞—Å–∞', '–Ω–µ—Ç—Ç–æ', '–≤–∞–≥–∞', '–æ–±\'—î–º', '–∫—ñ–ª—å–∫—ñ—Å—Ç—å',
            '–∞–ª–µ—Ä–≥–µ–Ω–∏', '–∞–ª–µ—Ä–≥–µ–Ω', '–º–æ–∂–µ', '–º—ñ—Å—Ç–∏—Ç–∏', '—Å–ª—ñ–¥–∏',
            '—É–º–æ–≤–∏', '–∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è', '–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è', '—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞', '—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫',
            '–≤–∏—Ä–æ–±–ª–µ–Ω–æ', '–¥–ª—è', '–∫—Ä–∞—ó–Ω–∞', '–ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è', '—É–∫—Ä–∞—ó–Ω–∞',
            '–µ–∫—Å–ø–æ—Ä—Ç–µ—Ä', '—ñ–º–ø–æ—Ä—Ç–µ—Ä', '–∞–¥—Ä–µ—Å–∞', '–∫–æ–Ω—Ç–∞–∫—Ç–∏', '—Ç–µ–ª–µ—Ñ–æ–Ω',
            '—à—Ç—Ä–∏—Ö–∫–æ–¥', '–∫–æ–¥', '–ø–∞—Ä—Ç—ñ—è', '—Å–µ—Ä—ñ—è',
            '–ø–æ–∂–∏–≤–Ω–∞', '—Ü—ñ–Ω–Ω—ñ—Å—Ç—å', '–µ–Ω–µ—Ä–≥–µ—Ç–∏—á–Ω–∞', '—Ü–µ–Ω–Ω–æ—Å—Ç—å', '–∫–∫–∞–ª', '–∫–¥–∂',
            '–±—ñ–ª–∫–∏', '–∂–∏—Ä–∏', '–≤—É–≥–ª–µ–≤–æ–¥–∏', '—Ü—É–∫–æ—Ä', '—Å—ñ–ª—å',
            
            # –°–ª–æ–≤–∞ –∏–∑ –æ–ø–∏—Å–∞–Ω–∏–π –∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã—Ö —Ñ—Ä–∞–∑ (–Ω–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã)
            '–Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∏–π', '–æ—Ä–≥–∞–Ω—ñ—á–Ω–∏–π', '–µ–∫–æ–ª–æ–≥—ñ—á–Ω–∏–π', '–±—ñ–æ',
            '–∑–Ω–µ–∂–∏—Ä–µ–Ω–∏–π', '–ª–µ–≥–∫–∏–π', '–±–µ–∑', '—Ü—É–∫—Ä—É', '—Å–æ–ª—ñ', '–ª–∞–∫—Ç–æ–∑–∏', '–≥–ª—é—Ç–µ–Ω—É',
            '–¥–æ–±—É—Ç–æ–∫', '—è—â–∏–∫', '–∫–æ—Ä–æ–±–∫–∞', '–∑–±–µ—Ä—ñ–≥–∞—Ç–∏', '–º—ñ—Å—Ü—ñ', '—Å—É—Ö–æ–º—É',
            '–∑–∞—Ö–∏—â–∞—Ç–∏', '—Å–æ–Ω—Ü—è', '–¥—ñ—Ç–µ–π', '–¥—ñ—Ç—è–º',
            '–ø—ñ—Å–ª—è', '–≤—ñ–¥–∫—Ä–∏—Ç—Ç—è', '–≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏',
            '–¥–æ–∑–æ–≤–∞–Ω–∏–π', '—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∞', '–¥–æ–±–∞', '–¥–æ–±–æ–≤–∞',
            '–≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è', '–≤–∏–º—ñ—Ä—é–≤–∞—á',
            '–æ–∑–Ω–∞–π–æ–º—Ç–µ—Å—å', '—ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—î—é', '–æ–±–µ—Ä–µ–∂–Ω–æ',
            
            # –ß–∞—Å—Ç—ã–µ –ø—Ä–µ–¥–ª–æ–≥–∏, —Å–æ—é–∑—ã –∏ –º–µ—Å—Ç–æ–∏–º–µ–Ω–∏—è (—É–∫—Ä–∞–∏–Ω—Å–∫–∏–µ)
            '—Ç–∞', '—ñ', '–∞–±–æ', '—á–∏', '–Ω–∞', '–≤', '—É', '–∑', '–∑—ñ', '–≤—ñ–¥', '–¥–æ', '–ø—Ä–æ',
            '–¥–ª—è', '–∑–∞', '–ø—ñ–¥', '–Ω–∞–¥', '–ø–µ—Ä–µ–¥', '–ø—ñ—Å–ª—è', '—á–µ—Ä–µ–∑',
            '—è–∫–∏–π', '—è–∫–∞', '—è–∫–µ', '—è–∫—ñ', '—â–æ', '—Ü–µ', '—Ç–æ–π', '—Ç–∞–∫–∏–π',
            
            # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –≥–ª–∞–≥–æ–ª—ã –∏–∑ –æ–ø–∏—Å–∞–Ω–∏–π
            '—á–∏—Å—Ç–∏–π', '—Å–≤—ñ–∂–∏–π', '—è–∫—ñ—Å–Ω–∏–π', '–±–µ–∑–ø–µ—á–Ω–∏–π', '–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∏–π',
            '–º—ñ—Å—Ç–∏—Ç—å', '—Å–∫–ª–∞–¥–∞—î—Ç—å—Å—è', '–ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π', '—Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è',
            '–Ω–∞–Ω–æ—Å–∏—Ç–∏', '–∑–º–∏–≤–∞—Ç–∏', '–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏', '–∑–∞—Å—Ç–æ—Å–æ–≤—É–≤–∞—Ç–∏',
            
            # –û–±—â–∏–µ —Å–ª–æ–≤–∞ –æ –∑–¥–æ—Ä–æ–≤—å–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
            '–∑–¥–æ—Ä–æ–≤\'—è', '–±–µ–∑–ø–µ–∫–∞', '–∞–ª–µ—Ä–≥—ñ—è', '—Ä–µ–∞–∫—Ü—ñ—è', '–ø–æ–¥—Ä–∞–∑–Ω–µ–Ω–Ω—è',
            '—Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è', '–¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è', '–∫–ª—ñ–Ω—ñ—á–Ω–æ', '–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ',
            
            # –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ (–æ–±—â–∏–µ)
            '–º–ª', '–ª', '–≥', '–∫–≥', '–º–≥', '–º–∫–≥', '–æ–¥', '—Ç–∞–±–ª–µ—Ç–∫–∞', '–∫–∞–ø—Å—É–ª–∞',
            '—à—Ç', '%', '–≤—ñ–¥—Å–æ—Ç–∫—ñ–≤', '–≥—Ä–∞–º', '–º—ñ–ª—ñ–ª—ñ—Ç—Ä',
        }
        
        print(f"‚úÖ IngredientChecker –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω: {len(self.local_ingredients)} –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ")
    
    def load_local_ingredients(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º –ø–æ–¥—Ö–æ–¥–æ–º)"""
        print("üìö –ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤...")
        ingredients = [
            # üî¥ HIGH RISK (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –û–ü–ê–°–ù–´–ï) - –ò–∑–±–µ–≥–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é
            {
                "id": 4,
                "name": "Formaldehyde",
                "risk_level": "high",
                "category": "preservative", 
                "description": "–ö–∞–Ω—Ü–µ—Ä–æ–≥–µ–Ω 1-–≥–æ –∫–ª–∞—Å—Å–∞, –∑–∞–ø—Ä–µ—â–µ–Ω –≤ –∫–æ—Å–º–µ—Ç–∏–∫–µ –≤–æ –º–Ω–æ–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∞—Ö",
                "aliases": [
                    "formaldehyde", 
                    "formalin", 
                    "—Ñ–æ—Ä–º–∞–ª—å–¥–µ–≥—ñ–¥",
                    "—Ñ–æ—Ä–º–∞–ª—ñ–Ω",
                    "formaldehydum",
                    "methyl aldehyde"
                ],
                "source": "local",
                "context": "–ó–∞–ø—Ä–µ—â–µ–Ω –≤ –ï–° –≤ –∫–æ—Å–º–µ—Ç–∏–∫–µ –¥–ª—è –¥–µ—Ç–µ–π"
            },
            {
                "id": 5,
                "name": "Methylisothiazolinone",
                "risk_level": "high",
                "category": "preservative",
                "description": "–°–∏–ª—å–Ω–µ–π—à–∏–π –∞–ª–ª–µ—Ä–≥–µ–Ω, –∑–∞–ø—Ä–µ—â–µ–Ω –≤ –Ω–µ—Å–º—ã–≤–∞–µ–º–æ–π –∫–æ—Å–º–µ—Ç–∏–∫–µ –≤ –ï–°",
                "aliases": [
                    "methylisothiazolinone",
                    "isothiazolinone",
                    "methylisothiazolino",
                    "–º—ñ—Ç—ñ–ª—ñ–∑–æ—Ç—ñ–∞–∑–æ–ª—ñ–Ω–æ–Ω",
                    "mi",
                    "mit"
                ],
                "source": "local",
                "context": "–ê–ª–ª–µ—Ä–≥–µ–Ω 2013 –≥–æ–¥–∞ –≤ –ï–≤—Ä–æ–ø–µ"
            },
            {
                "id": 21,
                "name": "Methylchloroisothiazolinone",
                "risk_level": "high",
                "category": "preservative",
                "description": "–°–∏–ª—å–Ω—ã–π –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç –∏ –∞–ª–ª–µ—Ä–≥–µ–Ω, —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–∞—Ä–µ —Å MI",
                "aliases": [
                    "methylchloroisothiazolinone",
                    "methylchloroisothiazolinone/methylisothiazolinone",
                    "5-chloro-2-methyl-4-isothiazolin-3-one",
                    "cmit",
                    "mi/mci"
                ],
                "source": "local",
                "context": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω –≤ –ï–° –¥–æ 0.0015%"
            },
            {
                "id": 10,
                "name": "Triclosan",
                "risk_level": "high",
                "category": "antibacterial",
                "description": "–í—ã–∑—ã–≤–∞–µ—Ç –∞–Ω—Ç–∏–±–∏–æ—Ç–∏–∫–æ—Ä–µ–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, —ç–Ω–¥–æ–∫—Ä–∏–Ω–Ω—ã–π –¥–∏–∑—Ä–∞–ø—Ç–æ—Ä",
                "aliases": [
                    "triclosan",
                    "—Ç—Ä–∏–∫–ª–æ–∑–∞–Ω",
                    "antibacterial agent",
                    "triclosanum",
                    "2,4,4'-trichloro-2'-hydroxydiphenyl ether"
                ],
                "source": "local",
                "context": "–ó–∞–ø—Ä–µ—â–µ–Ω –≤ –º—ã–ª–µ –≤ –°–®–ê —Å 2017"
            },
            {
                "id": 11,
                "name": "Oxybenzone",
                "risk_level": "high",
                "category": "UV filter",
                "description": "–•–∏–º–∏—á–µ—Å–∫–∏–π –£–§-—Ñ–∏–ª—å—Ç—Ä, –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç —á–µ—Ä–µ–∑ –∫–æ–∂—É, —ç–Ω–¥–æ–∫—Ä–∏–Ω–Ω—ã–π –¥–∏–∑—Ä–∞–ø—Ç–æ—Ä",
                "aliases": [
                    "oxybenzone",
                    "–±–µ–Ω–∑–æ—Ñ–µ–Ω–æ–Ω-3",
                    "benzophenone-3",
                    "–±–µ–Ω–∑–æ—Ñ–µ–Ω–æ–Ω",
                    "benzophenone",
                    "bp-3"
                ],
                "source": "local",
                "context": "–ó–∞–ø—Ä–µ—â–µ–Ω –Ω–∞ –ì–∞–≤–∞–π—è—Ö, —Ç–æ–∫—Å–∏—á–µ–Ω –¥–ª—è –∫–æ—Ä–∞–ª–ª–æ–≤"
            },
            
            # üü† MEDIUM RISK (–í–ù–ò–ú–ê–ù–ò–ï) - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–∂–µ
            {
                "id": 3,
                "name": "Parfum", 
                "risk_level": "medium",  # –ò–ó–ú–ï–ù–ï–ù–û –° high –ù–ê medium
                "category": "fragrance",
                "description": "–ê—Ä–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä. –ú–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –∞–ª–ª–µ—Ä–≥–∏—é —É 1-3% –ª—é–¥–µ–π. –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ 85% –∫–æ—Å–º–µ—Ç–∏–∫–∏.",
                "aliases": [
                    "parfum", 
                    "fragrance", 
                    "aroma", 
                    "perfume", 
                    "–ø–∞—Ä—Ñ—É–º", 
                    "–∞—Ä–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä",
                    "–æ—Ç–¥—É—à–∫–∞",
                    "frag",
                    "parfum/fragrance",
                    "fragrance/parfum",
                    "aromatic",
                    "–∞—Ä–æ–º–∞—Ç"
                ],
                "source": "local",
                "context": "–°–∞–º—ã–π —á–∞—Å—Ç—ã–π –∞–ª–ª–µ—Ä–≥–µ–Ω –≤ –∫–æ—Å–º–µ—Ç–∏–∫–µ"
            },
            {
                "id": 2, 
                "name": "Methylparaben",
                "risk_level": "medium",
                "category": "preservative",
                "description": "–ö–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç. –ù–∏–∑–∫–∏–π —Ä–∏—Å–∫ –≤ –∫–æ—Å–º–µ—Ç–∏–∫–µ –¥–ª—è —Å–º—ã–≤–∞–Ω–∏—è, —Å–ø–æ—Ä–Ω—ã–π –≤ –Ω–µ—Å–º—ã–≤–∞–µ–º–æ–π.",
                "aliases": [
                    "methylparaben", 
                    "methyl paraben", 
                    "–ø–∞—Ä–∞–±–µ–Ω",
                    "–ø–∞—Ä–∞–±–µ–Ω—ã",
                    "–º–µ—Ç–∏–ª–ø–∞—Ä–∞–±–µ–Ω",
                    "–∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç",
                    "e218",
                    "methylparabenum"
                ],
                "source": "local",
                "context": "–†–∞–∑—Ä–µ—à–µ–Ω –≤ –ï–° –¥–æ 0.4% (—Å–º–µ—Å—å –¥–æ 0.8%)"
            },
            {
                "id": 1,
                "name": "Sodium Laureth Sulfate",
                "risk_level": "medium",
                "category": "surfactant", 
                "description": "–ü–ê–í, –ø–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å. –ú–æ–∂–µ—Ç —Å—É—à–∏—Ç—å –∫–æ–∂—É. –ë–æ–ª–µ–µ –º—è–≥–∫–∏–π —á–µ–º SLS.",
                "aliases": [
                    "sodium laureth sulfate", 
                    "sodium lauryl sulfate",
                    "sles", 
                    "sls", 
                    "sodium lauryl ether sulfate",
                    "–Ω–∞—Ç—Ä—ñ—é –ª–∞—É—Ä–µ—Ç —Å—É–ª—å—Ñ–∞—Ç",
                    "–Ω–∞—Ç—Ä—ñ—é –ª–∞—É—Ä—ñ–ª —Å—É–ª—å—Ñ–∞—Ç",
                    "–ª–∞—É—Ä–µ—Ç —Å—É–ª—å—Ñ–∞—Ç –Ω–∞—Ç—Ä—ñ—é",
                    "–ª–∞—É—Ä—ñ–ª —Å—É–ª—å—Ñ–∞—Ç –Ω–∞—Ç—Ä—ñ—é",
                    "sodium laureth sulphate",
                    "sodium lauryl sulphate",
                    "–Ω–∞—Ç—Ä—ñ—É–º –ª–∞—É—Ä–µ—Ç —Å—É–ª—å—Ñ–∞—Ç"
                ],
                "source": "local",
                "context": "–ë–µ–∑–æ–ø–∞—Å–µ–Ω –≤ —Å–º—ã–≤–∞–µ–º—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–∞—Ö"
            },
            {
                "id": 12,
                "name": "Propylene Glycol",
                "risk_level": "medium",
                "category": "humectant",
                "description": "–£–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å –∏ —Ä–∞—Å—Ç–≤–æ—Ä–∏—Ç–µ–ª—å. –ú–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ (>20%).",
                "aliases": [
                    "propylene glycol",
                    "–ø—Ä–æ–ø—ñ–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—å",
                    "–ø—Ä–æ–ø—ñ–ª–µ–Ω –≥–ª—ñ–∫–æ–ª—å",
                    "1,2-propanediol",
                    "pg",
                    "propane-1,2-diol"
                ],
                "source": "local",
                "context": "–ë–µ–∑–æ–ø–∞—Å–µ–Ω –¥–æ 50% –≤ –∫–æ—Å–º–µ—Ç–∏–∫–µ"
            },
            {
                "id": 8,
                "name": "Alcohol Denat",
                "risk_level": "medium",
                "category": "solvent",
                "description": "–î–µ–Ω–∞—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Ä—Ç. –°—É—à–∏—Ç –∫–æ–∂—É, –Ω–∞—Ä—É—à–∞–µ—Ç –±–∞—Ä—å–µ—Ä. –ò–∑–±–µ–≥–∞—Ç—å –≤ –ø—Ä–æ–¥—É–∫—Ç–∞—Ö –¥–ª—è —Å—É—Ö–æ–π –∫–æ–∂–∏.",
                "aliases": [
                    "alcohol denat",
                    "alcohol",
                    "—Å–ø–∏—Ä—Ç",
                    "–¥–µ–Ω–∞—Ç—É—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Ä—Ç",
                    "ethanol",
                    "–∞–ª–∫–æ–≥–æ–ª—å",
                    "denatured alcohol",
                    "ethyl alcohol",
                    "sd alcohol"
                ],
                "source": "local",
                "context": "–ü—Ä–∏–µ–º–ª–µ–º –≤ —Ç–æ–Ω–∏–∫–∞—Ö –¥–ª—è –∂–∏—Ä–Ω–æ–π –∫–æ–∂–∏"
            },
            {
                "id": 6,
                "name": "Tetrasodium EDTA",
                "risk_level": "medium",
                "category": "chelating agent",
                "description": "–•–µ–ª–∞—Ç–æ—Ä. –£–ª—É—á—à–∞–µ—Ç –ø–µ–Ω—É –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. –ú–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ —É —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–∂–∏.",
                "aliases": [
                    "tetrasodium edta",
                    "edta",
                    "—Ç–µ—Ç—Ä–∞–Ω–∞—Ç—Ä—ñ–π –µ–¥—Ç–∞",
                    "—Ç–µ—Ç—Ä–∞—Å–æ–¥—ñ—É–º –µ–¥—Ç–∞",
                    "—Ö–µ–ª–∞—Ç—É—é—á–∏–π –∞–≥–µ–Ω—Ç",
                    "tetrasodium ethylenediaminetetraacetate",
                    "edta tetrasodium",
                    "edta-na4"
                ],
                "source": "local",
                "context": "–ë–µ–∑–æ–ø–∞—Å–µ–Ω –≤ –Ω–∏–∑–∫–∏—Ö –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è—Ö"
            },
            
            # üü° LOW RISK (–ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô) - –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ª—é–¥–µ–π
            {
                "id": 7,
                "name": "PEG-4",
                "risk_level": "low",
                "category": "emulsifier",
                "description": "–ü–æ–ª–∏—ç—Ç–∏–ª–µ–Ω–≥–ª–∏–∫–æ–ª—å –Ω–∏–∑–∫–æ–º–æ–ª–µ–∫—É–ª—è—Ä–Ω—ã–π. –≠–º—É–ª—å–≥–∞—Ç–æ—Ä, –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø—Ä–∏ —á–∏—Å—Ç–æ—Ç–µ >99.5%.",
                "aliases": [
                    "peg-4",
                    "peg",
                    "–ø–æ–ª—ñ–µ—Ç–∏–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—å",
                    "–ø–æ–ª—ñ–µ—Ç–∏–ª–µ–Ω –≥–ª—ñ–∫–æ–ª—å",
                    "peg 4",
                    "peg4",
                    "polyethylene glycol",
                    "polyoxyethylene"
                ],
                "source": "local",
                "context": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∞—Ä–º–∞—Ü–µ–≤—Ç–∏–∫–µ –∏ –∫–æ—Å–º–µ—Ç–∏–∫–µ"
            },
            {
                "id": 9,
                "name": "Mineral Oil",
                "risk_level": "low",
                "category": "emollient",
                "description": "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–µ –º–∞—Å–ª–æ –≤—ã—Å–æ–∫–æ–π –æ—á–∏—Å—Ç–∫–∏. –ù–µ –∑–∞–±–∏–≤–∞–µ—Ç –ø–æ—Ä—ã (–Ω–µ–∫–æ–º–µ–¥–æ–≥–µ–Ω–Ω–æ–µ), –æ–∫–∫–ª—é–∑–∏–≤–Ω–æ–µ —É–≤–ª–∞–∂–Ω–µ–Ω–∏–µ.",
                "aliases": [
                    "mineral oil",
                    "–ø–∞—Ä–∞—Ñ—ñ–Ω–æ–≤–µ –º–∞—Å–ª–æ",
                    "paraffinum liquidum",
                    "–≤–∞–∑–µ–ª—ñ–Ω",
                    "–º–∏–Ω–µ—Ä–∞–ª—å–Ω–æ–µ –º–∞—Å–ª–æ",
                    "paraffin oil",
                    "white mineral oil",
                    "liquid paraffin"
                ],
                "source": "local",
                "context": "–í—ã—Å—à–∞—è —Å—Ç–µ–ø–µ–Ω—å –æ—á–∏—Å—Ç–∫–∏ - –±–µ–∑–æ–ø–∞—Å–Ω–æ"
            },
            {
                "id": 13,
                "name": "Silicone",
                "risk_level": "low",
                "category": "emollient",
                "description": "–°–∏–ª–∏–∫–æ–Ω—ã (–¥–∏–º–µ—Ç–∏–∫–æ–Ω). –°–æ–∑–¥–∞–µ—Ç –∑–∞—â–∏—Ç–Ω—É—é –ø–ª–µ–Ω–∫—É, –Ω–µ–∫–æ–º–µ–¥–æ–≥–µ–Ω–Ω—ã–µ, –ª–µ–≥–∫–æ —Å–º—ã–≤–∞—é—Ç—Å—è.",
                "aliases": [
                    "silicone",
                    "—Å–∏–ª—ñ–∫–æ–Ω",
                    "dimethicone",
                    "—Ü–∏–∫–ª–æ–º–µ—Ç–∏–∫–æ–Ω",
                    "–¥–∏–º–µ—Ç–∏–∫–æ–Ω",
                    "dimeticone",
                    "cyclomethicone",
                    "polydimethylsiloxane"
                ],
                "source": "local",
                "context": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–º–ø–ª–∞–Ω—Ç–∞—Ö"
            },
            {
                "id": 14,
                "name": "Citric Acid",
                "risk_level": "low",
                "category": "pH adjuster",
                "description": "–õ–∏–º–æ–Ω–Ω–∞—è –∫–∏—Å–ª–æ—Ç–∞. –†–µ–≥—É–ª—è—Ç–æ—Ä pH, –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç. –ë–µ–∑–æ–ø–∞—Å–Ω–∞ –≤ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è—Ö.",
                "aliases": [
                    "citric acid",
                    "–ª–∏–º–æ–Ω–Ω–∞—è –∫–∏—Å–ª–æ—Ç–∞",
                    "—Å—ñ—Ç—ñ–ª–æ–≤–∞ –∫–∏—Å–ª–æ—Ç–∞",
                    "acidum citricum",
                    "e330"
                ],
                "source": "local",
                "context": "–ü—Ä–∏—Ä–æ–¥–Ω–∞—è –∫–∏—Å–ª–æ—Ç–∞, E330 –≤ –ø–∏—â–µ"
            },
            {
                "id": 15,
                "name": "Glycerin",
                "risk_level": "low",
                "category": "humectant",
                "description": "–ì–ª–∏—Ü–µ—Ä–∏–Ω. –ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —É–≤–ª–∞–∂–Ω–∏—Ç–µ–ª—å, –±–µ–∑–æ–ø–∞—Å–µ–Ω, –ø–æ–¥—Ö–æ–¥–∏—Ç –≤—Å–µ–º —Ç–∏–ø–∞–º –∫–æ–∂–∏.",
                "aliases": [
                    "glycerin",
                    "–≥–ª—ñ—Ü–µ—Ä–∏–Ω",
                    "glycerol",
                    "glycerine",
                    "1,2,3-propanetriol",
                    "e422"
                ],
                "source": "local",
                "context": "–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç —É–≤–ª–∞–∂–Ω–µ–Ω–∏—è"
            },
            {
                "id": 16,
                "name": "Cocamidopropyl Betaine",
                "risk_level": "low",
                "category": "surfactant",
                "description": "–ú—è–≥–∫–∏–π –ü–ê–í –∏–∑ –∫–æ–∫–æ—Å–æ–≤–æ–≥–æ –º–∞—Å–ª–∞. –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–∂–∏, –Ω–µ —Å—É—à–∏—Ç.",
                "aliases": [
                    "cocamidopropyl betaine",
                    "cocamidopropylbetaine",
                    "–∫–æ–ø–∞–º—ñ–¥–æ–ø—Ä–æ–ø—ñ–ª –±–µ—Ç–∞—ó–Ω",
                    "cocoamidopropyl betaine",
                    "cab",
                    "cocamidopropyl dimethyl glycine"
                ],
                "source": "local",
                "context": "–í—Å—Ç—Ä–µ—á–∞–µ—Ç—Å—è –≤ –¥–µ—Ç—Å–∫–æ–π –∫–æ—Å–º–µ—Ç–∏–∫–µ"
            },
            {
                "id": 17,
                "name": "Styrene Acrylates Copolymer",
                "risk_level": "low",
                "category": "film former",
                "description": "–ü–æ–ª–∏–º–µ—Ä –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏. –°–æ–∑–¥–∞–µ—Ç –ø–ª–µ–Ω–∫—É, –Ω–µ –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç –≤ –∫–æ–∂—É, –±–µ–∑–æ–ø–∞—Å–µ–Ω.",
                "aliases": [
                    "styrene acrylates copolymer",
                    "—Å—Ç–∏—Ä–æ–ª/–∞–∫—Ä–∏–ª–∞—Ç–∏ —Å–æ–ø–æ–ª–∏–º–µ—Ä",
                    "styrene/acrylates copolymer",
                    "synthetic polymer"
                ],
                "source": "local",
                "context": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ª–∞–∫–∞—Ö –¥–ª—è –≤–æ–ª–æ—Å"
            },
            {
                "id": 18,
                "name": "Coco Glucoside",
                "risk_level": "low",
                "category": "surfactant",
                "description": "–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –ü–ê–í –∏–∑ –∫–æ–∫–æ—Å–æ–≤–æ–≥–æ –º–∞—Å–ª–∞ –∏ –≥–ª—é–∫–æ–∑—ã. –ë–∏–æ—Ä–∞–∑–ª–∞–≥–∞–µ–º—ã–π, –º—è–≥–∫–∏–π.",
                "aliases": [
                    "coco glucoside",
                    "–∫–æ–∫–æ –≥–ª—é–∫–æ–∑–∏–¥",
                    "coconut glucoside",
                    "alkyl polyglucoside",
                    "apg"
                ],
                "source": "local",
                "context": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —ç–∫–æ-–∫–æ—Å–º–µ—Ç–∏–∫–µ"
            },
            {
                "id": 19,
                "name": "Hydrolyzed Silk Protein",
                "risk_level": "low",
                "category": "conditioning agent",
                "description": "–ì–∏–¥—Ä–æ–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π —à–µ–ª–∫–æ–≤—ã–π –ø—Ä–æ—Ç–µ–∏–Ω. –ö–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä –¥–ª—è –≤–æ–ª–æ—Å, —É–≤–ª–∞–∂–Ω—è–µ—Ç.",
                "aliases": [
                    "hydrolyzed silk protein",
                    "–≥—ñ–¥—Ä–æ–ª—ñ–∑–æ–≤–∞–Ω–∏–π —à–æ–≤–∫–æ–≤–∏–π –ø—Ä–æ—Ç–µ—ó–Ω",
                    "silk amino acids",
                    "silk protein",
                    "sericin"
                ],
                "source": "local",
                "context": "–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π –∫–æ–Ω–¥–∏—Ü–∏–æ–Ω–µ—Ä"
            },
            {
                "id": 22,
                "name": "PEG-4 Cocoate",
                "risk_level": "low",
                "category": "emulsifier",
                "description": "–≠—Ñ–∏—Ä –∫–æ–∫–æ—Å–æ–≤–æ–≥–æ –º–∞—Å–ª–∞ –∏ –ü–≠–ì-4. –≠–º—É–ª—å–≥–∞—Ç–æ—Ä, –±–µ–∑–æ–ø–∞—Å–µ–Ω.",
                "aliases": [
                    "peg-4 cocoate",
                    "peg-4 coconut ester",
                    "polyethylene glycol-4 coconut ester",
                    "coconut oil peg-4 esters"
                ],
                "source": "local",
                "context": "–ù–∞—Ç—É—Ä–∞–ª—å–Ω—ã–π —ç–º—É–ª—å–≥–∞—Ç–æ—Ä"
            },
            
            # üü¢ SAFE (–ë–ï–ó–û–ü–ê–°–ù–´–ï) - –ë–µ–∑ —Ä–∏—Å–∫–∞
            {
                "id": 20,
                "name": "Aqua",
                "risk_level": "safe",
                "category": "solvent",
                "description": "–í–æ–¥–∞. –û—Å–Ω–æ–≤–∞ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ä–µ–¥—Å—Ç–≤, –±–µ–∑–æ–ø–∞—Å–Ω–∞.",
                "aliases": [
                    "aqua",
                    "–≤–æ–¥–∞",
                    "water",
                    "eau",
                    "h2o"
                ],
                "source": "local",
                "context": "–û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–æ—Å–º–µ—Ç–∏–∫–∏"
            },
            
            # –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ (–¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã)
            {
                "id": 23,
                "name": "Sodium Benzoate",
                "risk_level": "low",
                "category": "preservative",
                "description": "–ö–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç. –†–∞–∑—Ä–µ—à–µ–Ω –≤ –ï–° –¥–æ 0.5%, –±–µ–∑–æ–ø–∞—Å–µ–Ω –≤ –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è—Ö.",
                "aliases": [
                    "sodium benzoate",
                    "–±–µ–Ω–∑–æ–∞—Ç –Ω–∞—Ç—Ä–∏—è",
                    "e211",
                    "benzoate de sodium"
                ],
                "source": "local",
                "context": "–ü–∏—â–µ–≤–æ–π –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç E211"
            },
            {
                "id": 24,
                "name": "Titanium Dioxide",
                "risk_level": "low",
                "category": "UV filter",
                "description": "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–π –£–§-—Ñ–∏–ª—å—Ç—Ä. –ù–µ –ø—Ä–æ–Ω–∏–∫–∞–µ—Ç –≤ –∫–æ–∂—É, –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–∞–∂–µ –¥–ª—è –¥–µ—Ç–µ–π.",
                "aliases": [
                    "titanium dioxide",
                    "–¥—ñ–æ–∫—Å–∏–¥ —Ç–∏—Ç–∞–Ω—É",
                    "ci 77891",
                    "tio2"
                ],
                "source": "local",
                "context": "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–π —Å–æ–ª–Ω—Ü–µ–∑–∞—â–∏—Ç–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä"
            },
            {
                "id": 25,
                "name": "Zinc Oxide",
                "risk_level": "low",
                "category": "UV filter",
                "description": "–ú–∏–Ω–µ—Ä–∞–ª—å–Ω—ã–π –£–§-—Ñ–∏–ª—å—Ç—Ä —à–∏—Ä–æ–∫–æ–≥–æ —Å–ø–µ–∫—Ç—Ä–∞. –ë–µ–∑–æ–ø–∞—Å–µ–Ω, –Ω–µ–∞–ª–ª–µ—Ä–≥–µ–Ω–Ω—ã–π.",
                "aliases": [
                    "zinc oxide",
                    "–æ–∫—Å–∏–¥ —Ü–∏–Ω–∫—É",
                    "ci 77947",
                    "zno"
                ],
                "source": "local",
                "context": "–ó–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–µ—Ç—Å–∫–∏—Ö —Å–∞–Ω—Å–∫—Ä–∏–Ω–æ–≤"
            },
            {
                "id": 26,
                "name": "Butylparaben",
                "risk_level": "medium",
                "category": "preservative",
                "description": "–ü–∞—Ä–∞–±–µ–Ω–æ–≤—ã–π –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç. –†–∞–∑—Ä–µ—à–µ–Ω —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ –≤ –ï–°.",
                "aliases": [
                    "butylparaben",
                    "–±—É—Ç–∏–ª–ø–∞—Ä–∞–±–µ–Ω",
                    "butyl paraben"
                ],
                "source": "local",
                "context": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω –≤ –ï–° –≤ –¥–µ—Ç—Å–∫–æ–π –∫–æ—Å–º–µ—Ç–∏–∫–µ"
            },
            {
                "id": 27,
                "name": "Propylparaben",
                "risk_level": "medium",
                "category": "preservative",
                "description": "–ü–∞—Ä–∞–±–µ–Ω–æ–≤—ã–π –∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç. –ê–Ω–∞–ª–æ–≥–∏—á–µ–Ω –º–µ—Ç–∏–ª–ø–∞—Ä–∞–±–µ–Ω—É –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.",
                "aliases": [
                    "propylparaben",
                    "–ø—Ä–æ–ø–∏–ª–ø–∞—Ä–∞–±–µ–Ω",
                    "propyl paraben"
                ],
                "source": "local",
                "context": "–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å –º–µ—Ç–∏–ª–ø–∞—Ä–∞–±–µ–Ω–æ–º"
            }
        ]
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(ingredients)} –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ —Å –ø—Ä–∞–∫—Ç–∏—á–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π —Ä–∏—Å–∫–æ–≤")
        return ingredients

    def load_common_fixes(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–ø–µ—á–∞—Ç–æ–∫"""
        print("üîß –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–ø–µ—á–∞—Ç–æ–∫...")
        fixes = {
            "methytisctvazuivare": "methylisothiazolinone",
            "methylisothiazolino": "methylisothiazolinone",
            "methylchloroiscthiazoline": "methylchloroisothiazolinone",
            "methylchloroisothiazolino": "methylchloroisothiazolinone",
            "—Ç–µ—Ç—Ä–∞—Å–æ–¥—ñ—É–º": "tetrasodium",
            "–µ–¥—Ç–∞": "edta",
            "–ø–∞—Ä—Ñ—é–º": "parfum",
            "–∞—Ä–æ–º–∞—Ç–∏–∑–∞—Ç–æ—Ä–∞": "aroma",
            "–∫–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç–∞": "preservative",
            "—Ñ–æ—Ä–º–∞–ª–¥–µ–≥–∏–¥": "formaldehyde",
            "–±–µ–Ω–∑–æ—Ñ–µ–Ω–æ–Ω": "oxybenzone",
            "—Å–∏–ª–∏–∫–æ–Ω–∞": "silicone",
            "–≥–ª–∏—Ü–µ—Ä–∏–Ω–∞": "glycerin",
            "—Ü–∏—Ç—Ä–∏–∫": "citric",
            "—Å—É–ª—å—Ñ–∞—Ç": "sulfate",
            "–ø–∞—Ä–∞–±–µ–Ω": "paraben",
            "–∞–ª–∫–æ–≥–æ–ª—å": "alcohol",
            "–Ω–∞—Ç—Ä—ñ—é": "sodium",
            "–ª–∞—É—Ä–µ—Ç": "laureth",
            "–ª–∞—É—Ä—ñ–ª": "lauryl",
            "–ø—Ä–æ–ø—ñ–ª–µ–Ω": "propylene",
            "–≥–ª—ñ—Ü–µ—Ä–∏–Ω": "glycerin",
            "–ø–æ–ª–∏—ç—Ç–∏–ª–µ–Ω–≥–ª–∏–∫–æ–ª—å": "polyethylene glycol",
            "–ø–æ–ª—ñ–µ—Ç–∏–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—å": "polyethylene glycol",
            "–º–∏–Ω–µ—Ä–∞–ª": "mineral",
            "oil": "oil",
            "–≤–∞–∑–µ–ª–∏–Ω": "vaseline",
            "–ø–∞—Ä–∞—Ñ—ñ–Ω": "paraffin",
            "—Ç—Ä–∏–∫–ª–æ–∑–∞–Ω": "triclosan",
            "–ø—Ä–æ–ø—ñ–ª–µ–Ω–≥–ª—ñ–∫–æ–ª—å": "propylene glycol",
            "—Å–∏–ª—ñ–∫–æ–Ω": "silicone",
            "–¥–∏–º–µ—Ç–∏–∫–æ–Ω": "dimethicone",
            "—Ü–∏–∫–ª–æ–º–µ—Ç–∏–∫–æ–Ω": "cyclomethicone",
            "–ª–∏–º–æ–Ω–Ω–∞—è": "citric",
            "–∫–∏—Å–ª–æ—Ç–∞": "acid",
            "–≥–ª—ñ—Ü–µ—Ä–∏–Ω": "glycerin",
            "–≥–ª–∏—Ü–µ—Ä–æ–ª": "glycerol",
            "cocamidopropyl": "cocamidopropyl",
            "betaine": "betaine",
            "—Å—Ç–∏—Ä–æ–ª": "styrene",
            "–∞–∫—Ä–∏–ª–∞—Ç–∏": "acrylates",
            "—Å–æ–ø–æ–ª–∏–º–µ—Ä": "copolymer",
            "–∫–æ–∫–æ": "coco",
            "–≥–ª—é–∫–æ–∑–∏–¥": "glucoside",
            "–≥–∏–¥—Ä–æ–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π": "hydrolyzed",
            "—à–µ–ª–∫–æ–≤—ã–π": "silk",
            "–ø—Ä–æ—Ç–µ–∏–Ω": "protein",
            "–≤–æ–¥–∞": "aqua",
            "water": "aqua",
            "–∞qua": "aqua",
            "cocoate": "cocoate",
            "–±–µ–Ω–∑–æ–∞—Ç": "benzoate",
            "–Ω–∞—Ç—Ä—ñ—è": "sodium",
            "–¥—ñ–æ–∫—Å–∏–¥": "dioxide",
            "—Ç–∏—Ç–∞–Ω—É": "titanium",
            "–æ–∫—Å–∏–¥": "oxide",
            "—Ü–∏–Ω–∫—É": "zinc"
        }
        print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(fixes)} –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –æ–ø–µ—á–∞—Ç–æ–∫")
        return fixes
    
    def _create_not_found_response(self, ingredient_name):
        """–°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –Ω–µ–Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π"""
        # –ü–æ–ø—Ä–æ–±—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ä–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
        risk_level = "unknown"
        
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞
        ingredient_lower = ingredient_name.lower()
        
        high_risk_patterns = [
            r'.*formaldehyd.*', r'.*—Ñ–æ—Ä–º–∞–ª—å–¥–µ–≥—ñ–¥.*',
            r'.*isothiazolinone.*', r'.*—ñ–∑–æ—Ç—ñ–∞–∑–æ–ª—ñ–Ω–æ–Ω.*',
            r'.*triclosan.*', r'.*—Ç—Ä–∏–∫–ª–æ–∑–∞–Ω.*',
            r'.*oxybenzone.*', r'.*–±–µ–Ω–∑–æ—Ñ–µ–Ω–æ–Ω.*'
        ]
        
        medium_risk_patterns = [
            r'.*paraben.*', r'.*–ø–∞—Ä–∞–±–µ–Ω.*',
            r'.*parfum.*', r'.*fragrance.*', r'.*–∞—Ä–æ–º–∞—Ç.*',
            r'.*alcohol.*', r'.*—Å–ø–∏—Ä—Ç.*',
            r'.*sulfate.*', r'.*—Å—É–ª—å—Ñ–∞—Ç.*',
            r'.*glycol.*', r'.*–≥–ª—ñ–∫–æ–ª—å.*'
        ]
        
        low_risk_patterns = [
            r'.*glycerin.*', r'.*–≥–ª—ñ—Ü–µ—Ä–∏–Ω.*',
            r'.*aqua.*', r'.*–≤–æ–¥–∞.*', r'.*water.*',
            r'.*benzoate.*', r'.*–±–µ–Ω–∑–æ–∞—Ç.*',
            r'.*dioxide.*', r'.*–¥—ñ–æ–∫—Å–∏–¥.*',
            r'.*oxide.*', r'.*–æ–∫—Å–∏–¥.*',
            r'.*acid.*', r'.*–∫–∏—Å–ª–æ—Ç–∞.*'
        ]
        
        for pattern in high_risk_patterns:
            if re.match(pattern, ingredient_lower):
                risk_level = "high"
                break
                
        if risk_level == "unknown":
            for pattern in medium_risk_patterns:
                if re.match(pattern, ingredient_lower):
                    risk_level = "medium"
                    break
                    
        if risk_level == "unknown":
            for pattern in low_risk_patterns:
                if re.match(pattern, ingredient_lower):
                    risk_level = "low"
                    break
        
        return {
            "name": ingredient_name,
            "risk_level": risk_level,
            "category": "unknown",
            "description": f"–Ü–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ –ª–æ–∫–∞–ª—å–Ω—ñ–π –±–∞–∑—ñ. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–µ–Ω–æ —Ä—ñ–≤–µ–Ω—å —Ä–∏–∑–∏–∫—É: {risk_level}",
            "source": "not_found",
            "aliases": [],
            "context": "–û—Ü—ñ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤ —É –Ω–∞–∑–≤—ñ"
        }
    
    def is_potential_ingredient(self, text):
        """–ü—Ä–æ–≤–µ—Ä–∫–∞, –º–æ–∂–µ—Ç –ª–∏ —Ç–µ–∫—Å—Ç –±—ã—Ç—å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–º (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤)"""
        if not text or len(text) < 3:
            return False
        
        text_lower = text.lower().strip()
        
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–æ–ø-—Å–ª–æ–≤–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫)
        if text_lower in self.stop_words:
            print(f"  ‚õî –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ —Å—Ç–æ–ø-—Å–ª–æ–≤–æ: '{text}'")
            return False
        
        # 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ —á–∏—Å–ª–æ–º –∏–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç–æ–º
        if text_lower.isdigit() or re.match(r'^\d+[.,]\d+$', text_lower):
            return False
        
        # 3. –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è –∏ —á–∏—Å–ª–∏—Ç–µ–ª—å–Ω—ã–µ
        measurement_units = ['–º–ª', '–ª', '–≥', '–∫–≥', '–º–≥', '–º–∫–≥', '—à—Ç', '%', '–≤—ñ–¥—Å–æ—Ç–∫—ñ–≤']
        if text_lower in measurement_units:
            return False
        
        # 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–∞ –∏–ª–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        address_patterns = [
            r'^\d{6}$',  # –ø–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å
            r'^—É–ª\.', r'^—É–ª–∏—Ü—è', r'^–≤—É–ª\.',
            r'^–¥\.', r'^–¥–æ–º', 
            r'^—Ç–µ–ª\.', r'^—Ç–µ–ª–µ—Ñ–æ–Ω', r'^\+?\d', r'^\d{3}-\d{3}-\d{4}',
            r'^email', r'^e-mail', r'^@',
            r'^http', r'^www\.', r'^https',
            r'^–≥\.', r'^–≥–æ—Ä–æ–¥', r'^–º\.',
            r'^–æ–±–ª\.', r'^–æ–±–ª–∞—Å—Ç—å',
            r'^—Ä-–Ω', r'^—Ä–∞–π–æ–Ω',
            r'^–ø–æ—Å\.', r'^–ø–æ—Å–µ–ª–æ–∫', r'^–ø–≥—Ç',
            r'^—Å\.', r'^—Å–µ–ª–æ',
            r'^–∫–≤\.', r'^–∫–≤–∞—Ä—Ç–∏—Ä–∞',
        ]
        
        for pattern in address_patterns:
            if re.search(pattern, text_lower, re.IGNORECASE):
                return False
        
        # 5. –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –æ–±—ã—á–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç –±—É–∫–≤—ã
        if not any(c.isalpha() for c in text):
            return False
        
        # 6. –•–∏–º–∏—á–µ—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Å—Ç–æ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
        has_uppercase = any(c.isupper() for c in text)
        has_hyphen = '-' in text
        has_digit = any(c.isdigit() for c in text)
        has_parentheses = '(' in text or ')' in text
        has_slash = '/' in text
        has_period = '.' in text and len(text) > 1
        
        # –ï—Å–ª–∏ —ç—Ç–æ –ø–æ—Ö–æ–∂–µ –Ω–∞ —Ö–∏–º–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ
        if has_uppercase or has_hyphen or has_digit or has_parentheses or has_slash or has_period:
            # –ù–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ —Å —Ç–æ—á–∫–æ–π
            if re.match(r'^\d+\.?\d*$', text):
                return False
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–æ –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ä–∞–∑–¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–°–∫–ª–∞–¥:")
            if text_lower.endswith(':'):
                return False
            
            return True
        
        # 7. –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Å–ª–æ–≤–∞—Ä—é –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –∏ –∏—Ö –∞–ª–∏–∞—Å–æ–≤
        for ingredient in self.local_ingredients:
            if text_lower == ingredient['name'].lower():
                return True
            for alias in ingredient.get('aliases', []):
                if text_lower == alias.lower():
                    return True
        
        # 8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —Ö–∏–º–∏—á–µ—Å–∫–∏–µ —Å—É—Ñ—Ñ–∏–∫—Å—ã
        ingredient_suffixes = ['ate', 'ide', 'one', 'ene', 'ol', 'ic', 'in', 'ose', 'ase', 'ium', 'um']
        for suffix in ingredient_suffixes:
            if text_lower.endswith(suffix) and len(text) > 3:
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª–æ–≤–æ –∏–∑ —Å—Ç–æ–ø-–ª–∏—Å—Ç–∞ —Å —Ç–∞–∫–∏–º —Å—É—Ñ—Ñ–∏–∫—Å–æ–º
                if text_lower not in self.stop_words:
                    return True
        
        return False
    
    def extract_ingredient_candidates(self, text):
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –∏–∑ —Ç–µ–∫—Å—Ç–∞"""
        if not text:
            return []
        
        print(f"\nüß™ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞ ({len(text)} —Å–∏–º–≤–æ–ª–æ–≤)")
        
        # –°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º —Å–ø–∏—Å–æ–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ (—á–∞—Å—Ç–æ –ø–æ—Å–ª–µ —Å–ª–æ–≤–∞ "–°–æ—Å—Ç–∞–≤:", "INGREDIENTS:", "INCI:")
        candidates = set()
        
        # –®–∞–≥ 1: –ò—â–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å–ø–∏—Å–∫–æ–≤ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
        ingredient_sections = []
        
        # –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–ø–∏—Å–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤
        start_patterns = [
            r'—Å–∫–ª–∞–¥[:\s]*',  # –£–∫—Ä–∞–∏–Ω—Å–∫–æ–µ "—Å–∫–ª–∞–¥"
            r'—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏[:\s]*',  # –£–∫—Ä–∞–∏–Ω—Å–∫–æ–µ "—ñ–Ω–≥—Ä–µ–¥—ñ—î–Ω—Ç–∏"
            r'–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã[:\s]*',
            r'ingredients[:\s]*',
            r'inci[:\s]*',
            r'components[:\s]*',
            r'contents[:\s]*',
            r'contains[:\s]*',
            r'constituents[:\s]*',
        ]
        
        for pattern in start_patterns:
            matches = list(re.finditer(pattern, text, re.IGNORECASE))
            for match in matches:
                start_pos = match.end()
                # –ò—â–µ–º –∫–æ–Ω–µ—Ü —Å–ø–∏—Å–∫–∞ (–¥–æ —Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –∏–ª–∏ –∫–æ–Ω—Ü–∞ —Ç–µ–∫—Å—Ç–∞)
                end_patterns = [
                    r'\n\s*[–ê-–ØA-Z]',  # –ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤–æ–π
                    r'\n\s*\d+\.',      # –ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —Å –Ω–æ–º–µ—Ä–æ–º
                    r'\.\s*\n',         # –¢–æ—á–∫–∞ –∏ –Ω–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞
                    r'\n{2,}',          # –î–≤–µ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
                    r'—É–º–æ–≤–∏', r'–∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è',  # –†–∞–∑–¥–µ–ª —É—Å–ª–æ–≤–∏–π
                    r'—Ç–µ—Ä–º—ñ–Ω', r'–ø—Ä–∏–¥–∞—Ç–Ω–æ—Å—Ç—ñ',  # –°—Ä–æ–∫ –≥–æ–¥–Ω–æ—Å—Ç–∏
                    r'–≤–∏—Ä–æ–±–Ω–∏–∫', r'–≤–∏–≥–æ—Ç–æ–≤–ª—é–≤–∞—á',  # –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å
                    r'–∞–ª–µ—Ä–≥–µ–Ω–∏', r'–∞–ª–µ—Ä–≥–µ–Ω',  # –†–∞–∑–¥–µ–ª –∞–ª–ª–µ—Ä–≥–µ–Ω–æ–≤
                ]
                
                end_pos = len(text)
                for end_pat in end_patterns:
                    end_match = re.search(end_pat, text[start_pos:], re.IGNORECASE)
                    if end_match:
                        end_pos = min(end_pos, start_pos + end_match.start())
                        break
                
                section = text[start_pos:end_pos].strip()
                if section and len(section) > 10:
                    ingredient_sections.append(section)
                    print(f"üìã –ù–∞–π–¥–µ–Ω —Ä–∞–∑–¥–µ–ª —Å –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞–º–∏: {section[:100]}...")
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –≤–µ—Å—å —Ç–µ–∫—Å—Ç
        if not ingredient_sections:
            ingredient_sections = [text]
        
        # –®–∞–≥ 2: –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏–∑ –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
        all_candidates = []
        
        for section in ingredient_sections:
            # –ß–∏—Å—Ç–∏–º —Ç–µ–∫—Å—Ç
            section = re.sub(r'[^\w\s.,;:\-‚Äì/()\d]', ' ', section)
            section = re.sub(r'\s+', ' ', section)
            
            # –†–∞–∑–¥–µ–ª—è–µ–º –Ω–∞ —Ç–æ–∫–µ–Ω—ã —Å —É—á–µ—Ç–æ–º —Å–ª–æ–∂–Ω—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π
            tokens = []
            current_token = []
            in_parentheses = 0
            
            for char in section:
                if char == '(':
                    in_parentheses += 1
                    current_token.append(char)
                elif char == ')':
                    in_parentheses -= 1
                    current_token.append(char)
                elif char in [',', ';'] and in_parentheses == 0:
                    if current_token:
                        token_str = ''.join(current_token).strip()
                        if token_str:
                            tokens.append(token_str)
                        current_token = []
                elif char == '.' and in_parentheses == 0:
                    # –¢–æ—á–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å —á–∞—Å—Ç—å—é —Ö–∏–º–∏—á–µ—Å–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, "PEG-4")
                    current_token.append(char)
                else:
                    current_token.append(char)
            
            if current_token:
                token_str = ''.join(current_token).strip()
                if token_str:
                    tokens.append(token_str)
            
            # –§–∏–ª—å—Ç—Ä—É–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤
            for token in tokens:
                # –û—á–∏—â–∞–µ–º —Ç–æ–∫–µ–Ω –æ—Ç –ª–∏—à–Ω–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
                clean_token = token.strip(' ,.;:')
                
                # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—É—Å—Ç—ã–µ —Ç–æ–∫–µ–Ω—ã
                if not clean_token:
                    continue
                
                # –†–∞–∑–¥–µ–ª—è–µ–º —Å–ª–æ–∂–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "Methylchloroisothiazolinone/Methylisothiazolinone")
                if '/' in clean_token:
                    sub_tokens = clean_token.split('/')
                    for sub_token in sub_tokens:
                        sub_token_clean = sub_token.strip()
                        if sub_token_clean and self.is_potential_ingredient(sub_token_clean):
                            all_candidates.append(sub_token_clean)
                            print(f"  üß™ –ö–∞–Ω–¥–∏–¥–∞—Ç (–∏–∑ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏): '{sub_token_clean}'")
                else:
                    if self.is_potential_ingredient(clean_token):
                        all_candidates.append(clean_token)
                        print(f"  üß™ –ö–∞–Ω–¥–∏–¥–∞—Ç: '{clean_token}'")
        
        # –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
        unique_candidates = []
        seen = set()
        for candidate in all_candidates:
            candidate_lower = candidate.lower()
            if candidate_lower not in seen:
                seen.add(candidate_lower)
                unique_candidates.append(candidate)
        
        print(f"üìä –ù–∞–π–¥–µ–Ω–æ {len(unique_candidates)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤")
        return unique_candidates
    
    def search_ingredient(self, ingredient_name):
        """–£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞"""
        
        if not ingredient_name or not isinstance(ingredient_name, str):
            return self._create_not_found_response(ingredient_name)
        
        ingredient_name = ingredient_name.strip()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
        cache_key = ingredient_name.lower()
        if cache_key in self.search_cache:
            cached_result = self.search_cache[cache_key]
            cache_age = datetime.now() - cached_result['timestamp']
            if cache_age < timedelta(hours=24):
                return cached_result['data']
        
        # 1. –ü–æ–∏—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ
        local_result = self._search_local(ingredient_name)
        if local_result:
            self.search_cache[cache_key] = {
                'data': local_result,
                'timestamp': datetime.now(),
                'source': 'local'
            }
            return local_result
        
        # 2. –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫
        cleaned_name = self.clean_text(ingredient_name)
        if cleaned_name != ingredient_name.lower():
            local_result = self._search_local(cleaned_name)
            if local_result:
                self.search_cache[cache_key] = {
                    'data': local_result,
                    'timestamp': datetime.now(),
                    'source': 'local (fixed)'
                }
                return local_result
        
        # 3. –ü–æ–∏—Å–∫ –≤–æ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç)
        if self.use_cache:
            try:
                external_result = self.external_sources.search(ingredient_name)
                if external_result and external_result.get('source') != 'not_found':
                    self.search_cache[cache_key] = {
                        'data': external_result,
                        'timestamp': datetime.now(),
                        'source': 'external'
                    }
                    return external_result
            except Exception as e:
                # –ï—Å–ª–∏ –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
                pass
        
        # 4. –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
        not_found_result = self._create_not_found_response(ingredient_name)
        self.search_cache[cache_key] = {
            'data': not_found_result,
            'timestamp': datetime.now(),
            'source': 'not_found'
        }
        return not_found_result
    
    def _search_local(self, ingredient_name):
        """–ü–æ–∏—Å–∫ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑–µ"""
        ingredient_lower = ingredient_name.lower()
        
        for ingredient in self.local_ingredients:
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∏–º–µ–Ω–∏
            if ingredient_lower == ingredient['name'].lower():
                return ingredient
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–ª–∏–∞—Å–æ–≤
            for alias in ingredient.get('aliases', []):
                if ingredient_lower == alias.lower():
                    return ingredient
        
        return None
    
    def clean_text(self, text):
        """–û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –ø–µ—Ä–µ–¥ –ø–æ–∏—Å–∫–æ–º"""
        if not text:
            return ""
        
        text = text.lower()
        text = re.sub(r'[^a-zA-Z0-9–∞-—è–ê-–Ø—ñ–Ü—ó–á—î–Ñ\s\-.,]', ' ', text)
        text = re.sub(r'\s+', ' ', text)
        
        # –ü—Ä–∏–º–µ–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—á–∞—Ç–æ–∫
        for wrong, correct in self.common_fixes.items():
            if wrong.lower() in text:
                text = text.replace(wrong.lower(), correct.lower())
        
        return text.strip()
    
    def find_ingredients(self, text):
        """–£–ª—É—á—à–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤"""
        if not text or not isinstance(text, str):
            print("‚ö†Ô∏è –¢–µ–∫—Å—Ç –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å—Ç—Ä–æ–∫–æ–π")
            return []
        
        print(f"\nüîç –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ")
        
        # 1. –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
        candidates = self.extract_ingredient_candidates(text)
        
        # 2. –ò—â–µ–º –∫–∞–∂–¥—ã–π –∫–∞–Ω–¥–∏–¥–∞—Ç
        found_ingredients = []
        seen_names = set()
        
        for candidate in candidates:
            ingredient = self.search_ingredient(candidate)
            
            if ingredient['name'] not in seen_names:
                found_ingredients.append(ingredient)
                seen_names.add(ingredient['name'])
                risk_icon = "üî¥" if ingredient['risk_level'] == 'high' else \
                           "üü†" if ingredient['risk_level'] == 'medium' else \
                           "üü°" if ingredient['risk_level'] == 'low' else \
                           "üü¢" if ingredient['risk_level'] == 'safe' else "‚ö´"
                print(f"‚úÖ {risk_icon} –ù–∞–π–¥–µ–Ω: {ingredient['name']} (—Ä–∏—Å–∫: {ingredient['risk_level']}, –∏—Å—Ç–æ—á–Ω–∏–∫: {ingredient.get('source', 'local')})")
        
        print(f"üìä –ò–¢–û–ì–û: –Ω–∞–π–¥–µ–Ω–æ {len(found_ingredients)} –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤")
        
        # 3. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∏—Å–∫–∞–º
        risk_stats = {
            'high': 0,
            'medium': 0,
            'low': 0,
            'safe': 0,
            'unknown': 0
        }
        
        for ing in found_ingredients:
            risk = ing.get('risk_level', 'unknown')
            if risk in risk_stats:
                risk_stats[risk] += 1
        
        print(f"üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∏—Å–∫–æ–≤: üî¥ {risk_stats['high']} üü† {risk_stats['medium']} üü° {risk_stats['low']} üü¢ {risk_stats['safe']} ‚ö´ {risk_stats['unknown']}")
        
        return found_ingredients


class ExternalDataFetcher:
    """–ö–ª–∞—Å—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"""
    
    def __init__(self, cache_dir='data_cache'):
        self.cache_dir = cache_dir
        self.cache_file = os.path.join(cache_dir, 'external_cache.db')
        os.makedirs(cache_dir, exist_ok=True)
        
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∞ SQLite
        self.init_cache()
        print(f"‚úÖ ExternalDataFetcher –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, –∫—ç—à: {self.cache_file}")
        
    def init_cache(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫—ç—à–∞"""
        conn = sqlite3.connect(self.cache_file)
        cursor = conn.cursor()
        
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS ingredients_cache (
                name TEXT PRIMARY KEY,
                data TEXT,
                source TEXT,
                last_updated TIMESTAMP
            )
        ''')
        
        conn.commit()
        conn.close()
    
    def search(self, ingredient_name):
        """–ü–æ–∏—Å–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞ –≤–æ –≤–Ω–µ—à–Ω–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏"""
        
        # 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
        cached = self._get_from_cache(ingredient_name)
        if cached:
            return cached
        
        # 2. –ü—Ä–æ–±—É–µ–º —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏, –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
        try:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
            test_url = "http://www.google.com"
            requests.get(test_url, timeout=3)
            
            # –ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –µ—Å—Ç—å, –ø—Ä–æ–±—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            result = None
            
            # –ò—Å—Ç–æ—á–Ω–∏–∫ 1: CosIng (–ï–°)
            result = self._search_cosing(ingredient_name)
            
            # –ò—Å—Ç–æ—á–Ω–∏–∫ 2: Open Food Facts (–µ—Å–ª–∏ CosIng –Ω–µ –¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)
            if not result:
                result = self._search_openfoodfacts(ingredient_name)
            
            # –ò—Å—Ç–æ—á–Ω–∏–∫ 3: PubChem (—Ö–∏–º–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è)
            if not result:
                result = self._search_pubchem(ingredient_name)
            
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
            if result:
                self._save_to_cache(ingredient_name, result)
            
            return result
            
        except (requests.ConnectionError, requests.Timeout):
            # –ù–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º None
            print(f"‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏")
            return None
    
    def _search_cosing(self, ingredient_name):
        """–ü–æ–∏—Å–∫ –≤ –±–∞–∑–µ CosIng –ï–°"""
        try:
            # CosIng API endpoint (–ø—Ä–∏–º–µ—Ä–Ω—ã–π)
            # –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π API
            url = f"https://ec.europa.eu/growth/tools-databases/cosing/api/ingredient/{ingredient_name}"
            
            print(f"üîó –ó–∞–ø—Ä–æ—Å –∫ CosIng API: {ingredient_name}")
            
            # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            if 'paraben' in ingredient_name.lower():
                return {
                    "name": ingredient_name,
                    "risk_level": "medium",
                    "category": "preservative",
                    "description": "–ö–æ–Ω—Å–µ—Ä–≤–∞–Ω—Ç –ø–∞—Ä–∞–±–µ–Ω–æ–≤–æ–≥–æ —Ä—è–¥–∞. –†–∞–∑—Ä–µ—à–µ–Ω –≤ –ï–° —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.",
                    "source": "cosing",
                    "aliases": [],
                    "context": "–ï–° –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è: –¥–æ 0.4% (—Å–º–µ—Å—å –¥–æ 0.8%)"
                }
            
            return None
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ CosIng API: {e}")
            return None
    
    def _search_openfoodfacts(self, ingredient_name):
        """–ü–æ–∏—Å–∫ –≤ Open Food Facts"""
        try:
            # Open Food Facts API
            url = f"https://world.openfoodfacts.org/api/v0/product/ingredient/{ingredient_name}.json"
            
            response = requests.get(url, timeout=5)
            
            if response.status_code == 200:
                data = response.json()
                
                if data.get('product'):
                    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Å–∫ –ø–æ —Ç–∏–ø—É –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞
                    risk_level = "low"
                    if any(word in ingredient_name.lower() for word in ['preservative', 'artificial', 'color']):
                        risk_level = "medium"
                    
                    ingredient_data = {
                        "name": ingredient_name,
                        "risk_level": risk_level,
                        "category": "food_ingredient",
                        "description": f"–ü–∏—â–µ–≤–æ–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç",
                        "source": "openfoodfacts",
                        "aliases": [],
                        "context": "–î–∞–Ω–Ω—ã–µ –∏–∑ Open Food Facts"
                    }
                    
                    return ingredient_data
            
            return None
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ Open Food Facts API: {e}")
            return None
    
    def _search_pubchem(self, ingredient_name):
        """–ü–æ–∏—Å–∫ –≤ PubChem —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π —Ä–∏—Å–∫–∞"""
        try:
            # PubChem API
            url = f"https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/{ingredient_name}/JSON"
            
            response = requests.get(url, timeout=5)
            
            if response.status_code == 200:
                data = response.json()
                
                # –£–ª—É—á—à–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–∏—Å–∫–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
                ingredient_lower = ingredient_name.lower()
                risk_level = "unknown"
                category = "chemical"
                
                # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∏—Å–∫ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                if any(word in ingredient_lower for word in ['paraben', 'isothiazolinone', 'formalde']):
                    risk_level = "high" if 'isothiazolinone' in ingredient_lower or 'formalde' in ingredient_lower else "medium"
                    category = "preservative"
                elif any(word in ingredient_lower for word in ['parfum', 'fragrance', 'perfume']):
                    risk_level = "medium"
                    category = "fragrance"
                elif any(word in ingredient_lower for word in ['alcohol', 'glycol']):
                    risk_level = "medium"
                    category = "solvent"
                elif any(word in ingredient_lower for word in ['glycerin', 'aqua', 'water', 'oil']):
                    risk_level = "low"
                    category = "base" if 'aqua' in ingredient_lower or 'water' in ingredient_lower else "emollient"
                elif any(word in ingredient_lower for word in ['acid', 'ate']):
                    risk_level = "low"
                    category = "pH adjuster" if 'acid' in ingredient_lower else "ester"
                
                ingredient_data = {
                    "name": ingredient_name,
                    "risk_level": risk_level,
                    "category": category,
                    "description": f"–•–∏–º–∏—á–µ—Å–∫–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ: {ingredient_name}",
                    "source": "pubchem",
                    "aliases": [],
                    "context": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ü–µ–Ω–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è"
                }
                
                return ingredient_data
            
            return None
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ PubChem API: {e}")
            return None
    
    def _get_from_cache(self, ingredient_name):
        """–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –∫—ç—à–∞"""
        try:
            conn = sqlite3.connect(self.cache_file)
            cursor = conn.cursor()
            
            cursor.execute(
                "SELECT data FROM ingredients_cache WHERE name = ? AND last_updated > datetime('now', '-7 days')",
                (ingredient_name.lower(),)
            )
            
            result = cursor.fetchone()
            conn.close()
            
            if result:
                return json.loads(result[0])
            
            return None
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –∫—ç—à–∞: {e}")
            return None
    
    def _save_to_cache(self, ingredient_name, data):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à"""
        try:
            conn = sqlite3.connect(self.cache_file)
            cursor = conn.cursor()
            
            cursor.execute(
                "INSERT OR REPLACE INTO ingredients_cache (name, data, source, last_updated) VALUES (?, ?, ?, datetime('now'))",
                (ingredient_name.lower(), json.dumps(data), data.get('source', 'unknown'))
            )
            
            conn.commit()
            conn.close()
            
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –∫—ç—à: {e}")


# –î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
if __name__ == "__main__":
    checker = IngredientChecker(use_cache=True)
    
    test_texts = [
        "–°–∫–ª–∞–¥: Aqua, Parfum, Glycerin, Methylparaben, Sodium Laureth Sulfate",
        "Ingredients: Water, Fragrance, Propylene Glycol, Oxybenzone",
        "–°–æ—Å—Ç–∞–≤: –§–æ—Ä–º–∞–ª—å–¥–µ–≥—ñ–¥, –ú–µ—Ç–∏–ª—ñ–∑–æ—Ç—ñ–∞–∑–æ–ª—ñ–Ω–æ–Ω, –¢—Ä–∏–∫–ª–æ–∑–∞–Ω, –ë–µ–Ω–∑–æ–∞—Ç –Ω–∞—Ç—Ä—ñ—é",
        "INCI: Dimethicone, Titanium Dioxide, Zinc Oxide, Alcohol Denat",
    ]
    
    print("\n" + "=" * 60)
    print("üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –û–ë–ù–û–í–õ–ï–ù–ù–û–ì–û INGREDIENT CHECKER")
    print("üî¥ High   üü† Medium   üü° Low   üü¢ Safe   ‚ö´ Unknown")
    print("=" * 60)
    
    for i, text in enumerate(test_texts, 1):
        print(f"\nüìù –¢–µ—Å—Ç #{i}:")
        print(f"–¢–µ–∫—Å—Ç: {text[:80]}...")
        
        result = checker.find_ingredients(text)
        
        print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç: {len(result)} –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤")
        
        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —É—Ä–æ–≤–Ω—é —Ä–∏—Å–∫–∞
        grouped = {}
        for ing in result:
            risk = ing.get('risk_level', 'unknown')
            if risk not in grouped:
                grouped[risk] = []
            grouped[risk].append(ing)
        
        # –í—ã–≤–æ–¥–∏–º –ø–æ –≥—Ä—É–ø–ø–∞–º —Ä–∏—Å–∫–∞
        for risk_level in ['high', 'medium', 'low', 'safe', 'unknown']:
            if risk_level in grouped and grouped[risk_level]:
                icon = "üî¥" if risk_level == 'high' else \
                       "üü†" if risk_level == 'medium' else \
                       "üü°" if risk_level == 'low' else \
                       "üü¢" if risk_level == 'safe' else "‚ö´"
                print(f"\n{icon} {risk_level.upper()} —Ä–∏—Å–∫ ({len(grouped[risk_level])}):")
                for ing in grouped[risk_level]:
                    print(f"  - {ing['name']} ({ing.get('category', 'N/A')})")
    
    print("\n" + "=" * 60)
    print("‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")
    print("=" * 60)
    print("\nüí° –ü—Ä–∞–∫—Ç–∏—á–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏:")
    print("  üî¥ HIGH: –ò–∑–±–µ–≥–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é (–∫–∞–Ω—Ü–µ—Ä–æ–≥–µ–Ω—ã, —Å–∏–ª—å–Ω—ã–µ –∞–ª–ª–µ—Ä–≥–µ–Ω—ã)")
    print("  üü† MEDIUM: –û—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∫–æ–∂–µ (–ø–∞—Ä—Ñ—é–º, –ø–∞—Ä–∞–±–µ–Ω—ã)")
    print("  üü° LOW: –ù–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ (–≥–ª–∏—Ü–µ—Ä–∏–Ω, —Å–∏–ª–∏–∫–æ–Ω—ã)")
    print("  üü¢ SAFE: –ë–µ–∑ —Ä–∏—Å–∫–∞ (–≤–æ–¥–∞)")